---
title: "Using R to visualize Arduino-iot weather sensor data"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: true
    toc_float: yes
    theme: flatly
    highlight: textmate
    css: style.css
editor_options:
  chunk_output_type: console
---
# Motivation

I have always been fascinated by the potential of open-source tools interaction, 
among which `R` (long live `R`!) and lately Arduino.

For those who don't know, **Arduino** is an open-source hardware and software company
which designs and produces microcontroller kits for the deployment of digital services, 
both at a professional, hobby and educational level. Furthermore, the community is
very active and smart.

[**Here**](https://create.arduino.cc/projecthub/){target="_blank"} you can find many projects,
including Home Automation, Robotics and even more.

![](images/arduino-projects.png)

To me as a data scientist with a statistical background, electronics is a black box, for
this reason I chose to a 99% plug-and-play solution: Arduino Opl√† IoT Kit.

If you want to know more, here's a video introducing you the kit:

<iframe width="560" height="315" src="https://www.youtube.com/embed/livKtMZQMS8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="margin: 0 auto; display: block; padding: 20px;"></iframe>

The kit comes with 4 integrated sensor measuring **Humidity**, **Pressure**, 
**Temperature** and **Light**.

Starting to collect data from these sensor is very simple: you just need to deploy 
an appropriate _sketch_ to the mother board, which can be done through the dedicated IDE or a
guided procedure.

Once everything is set up, you will have data flowing from sensors to the cloud and
visibile via a dashboard hosted on [**Arduino Cloud**](https://create.arduino.cc/iot/){target="_blank"},
free for 12 months with the kit purchase.
[**Here**](https://create.arduino.cc/iot/dashboards/9d492935-cf9c-4947-83f9-f9426ac1d20b/){target="_blank"}
 you can access mine to have an idea.

**Data are stored into a cloud database and retrival of data is possible throught an API
which can be queried, guess what...**

<center><font size="5">**with `R`!**</font></center>

# Goal

> The goal of the project is to deploy a dashboard on github which shows Arduino sensor
data and it is updated every 15 minutes. Documentation (and this very document you are
reading) must automatically versionised at every commit and every version easily 
accessible. Every software used must be for free.

# Project setup

The `R` ecosystem is constantly growing, adding new amazing productive tools such as 
[**Workflowr**](https://workflowr.github.io/workflowr/){target="_blank"} and
[**Flexdashboard**](https://pkgs.rstudio.com/flexdashboard/){target="_blank"}, which
perfectly exploit [**Github actions**](https://github.com/features/actions){target="_blank"}
in order to automatize their scope.

Furthermore, in order to make it easier to access [**Arduino Iot Cloud API **](https://www.arduino.cc/reference/en/iot/api/){target="_blank"}, I developed an 
`R` package through [**pkgdown**](https://pkgdown.r-lib.org/){target="_blank"}.
The package is called [**Rduinoiot**](https://flavioleccese92.github.io/Rduinoiot/){target="_blank"} and can be found on `CRAN`.

![](images/environment-setup.png)

# Workflowr
[**Workflowr**](https://workflowr.github.io/workflowr/){target="_blank"} is an `R` 
package that supports you in creating an **organized**, **reproducible** and **shareable**
project on **Github** or **Gitlab**.

Practically speaking, when opening RStudio to start a new project, if you
have Worflowr installed, you will see a new option. By chosing it, you are creating
automatically a git-versioned project with organized subdirectories. 

To tell Worflowr which git account to use, run the function:

```{r eval=FALSE, include=TRUE}
wflow_git_config(user.name = "Full Name", user.email = "email@domain")
```

Then you can create rmarkdown analyses and make them accessible by a customizable
website hosted for free on Github or Gitlab.

The two type of files relevant for a workflowr site are `*.Rmd`s and `_site.yml`.

## Analysis files `*.Rmd`

Any type of rmarkdown file can be added to your site. Only restriction, of course, 
is that your files cannot be `shiny` markdowns since they need a server to process
live user interactions and in our setup we do not have it, so avoid `runtime: shiny`.
Rmarkdown files are static html and usually not optimal for reporting analysis of 
data which require frequent updates.
Additionally, for my porpuse an ordinary markdown would not have satisfied my graphical
obsession.

For these two reasons, I decided to go with `flexdashboard` (to obtain a catchy but
static report) + `github actions` (to update the static HTML with new data every 15 
minutes). But we will talk about it later in this document.

The most important part of the rmarkdown is the **header**, which will be automatically
generated by workflowr and is customizable:

```{r eval=FALSE, include=TRUE}
---
title: "Using R to visualize Arduino-iot weather sensor data"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: true
    toc_float: yes
    theme: flatly
    highlight: textmate
    css: style.css
editor_options:
  chunk_output_type: console
---
```

Analysis files `*.Rmd` need to be stored under `analysis/` folder.

Once you are done with your analysis, you can build your site locally:

```{r eval=FALSE, include=TRUE}
wflow_build()
```

If not specified, `workflowr` will add to the local site each of your analysis in 
the `analysis/` folder.

Then, if you are ready to put it online, simply choose which analysis you want to
publish and run the following:

```{r eval=FALSE, include=TRUE}
wflow_publish(c("analysis/index.Rmd", "analysis/license.Rmd"))
```

This creates a commit and at the next push git will trigger the action to build the
site.

## Structure site file `_site.yml`

The design of the site which will host analysis is defined by the `_site.yml`.

The most important things you can customize are the **theme**, the **navigation bar**, 
which **analysis** has to be shown and where (and any HTML file too) and the **footer**.
[**Here**](https://jdblischak.github.io/workflowrBeta/articles/wflow-02-customization.html){target="_blank"}
you can find more information.

While I am writing this document, the `_site.yml` of this site is the following:

```{r eval=FALSE, include=TRUE}
name: "Rduinoiot-analysis"
output_dir: ../docs
navbar:
  title: "Rduinoiot-analysis"
  left:
  - text: Home
    href: index.html
  - text: Weather report
    href: weather-report.html
  - text: License
    href: license.html
output:
  workflowr::wflow_html:
    toc: true
    toc_float: yes
    theme: flatly
    highlight: textmate
    css: style.css
editor_options:
  chunk_output_type: console
```

A `style.css` file is stored under `docs` subdirectory for additional graphical customization. 

# Flexdashboard
[**Flexdashboard**](https://pkgs.rstudio.com/flexdashboard/){target="_blank"} is an `R` package 
which allows to easily develop dashboards as you were writing a simple `rmarkdown` document.

I confess that I always had prefered `Shiny apps` for their interactivity, but they require
a server and the graphical needs of my app exceeded the RAM constraint of [**shinyapps.io**](https://www.shinyapps.io/){target="_blank"} free plan.

However, even if not real time and without user interaction, refreshing the `flexdashboard`
with new data driven by free `github actions` did the trick. Furthermore, having 
analysis together with documentation in a `workflowr` site seemed pretty cool.

![](images/weather-report.png)

As usual, creating a `flexdashboard` is straight-forward: if you have the package 
installed, in **Rstudio** choose new *R Markdown...* > *From template* > *Flex dashboard*.
Again, the header is very important and you will note that, when comparing with 
the `workflower` earlied showed, you will see:

```{r eval=FALSE, include=TRUE}
---
...
output: 
  flexdashboard::flex_dashboard:
...
---
```




